version: '3'

services:

  airflow:
    image: apache/airflow:1.10.14
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        airflow initdb
        airflow scheduler &
        airflow webserver
    ports:
      - 8080:8080
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://localhost:8080/health"]
      interval: 10s
      timeout: 10s
      retries: 5
    volumes:
      - ./dags:/opt/airflow/dags
      - ../unaflow:/opt/airflow/plugins/unaflow
      - ${HOME}/.config:/home/airflow/.config